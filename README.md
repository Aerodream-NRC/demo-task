# **Тестовое задание по работе с документами**

## **Описание :**

### Проект состоит из двух частей:

 - Сервис **demo-task** (порт 8080) *основное приложение, предоставляющее REST API для управления документами (создание, изменение статуса, просмотр).*
 - Сервис **document-generator** (порт 8081) *вспомогательный инструмент для массовой генерации документов путём асинхронной отправки запросов в сервис.*

### Технологии :

 - **Java 21**
 - **Spring Boot**
 - **Gradle**
 - **PostgreSQL**
 - **Docker**

## **Запуск проекта :**

### Запуск в Docker :
#### - Соберите JAR-файл:
#### - Выберите дерикторию проекта и затем выполните команду :
```bash
/gradlew clean build -x test
```
#### - запустите Docker-compose файл:
```bash
/docker-compose up -d --build
```
### Локальный запуск *(без Docker)*

#### - После запуска в докере выполните эту команду :
```bash
/docker stop demo-task document-generator
```
#### - Перейдите в корневую папку проекта demo-task.

#### - Выполните команду:
```bash
/gradlew bootRun
```
##### Сервис будет доступен по адресу: *http://localhost:8080*

#### - Затем перейдите в папку document-generator и выполните команду
```bash
/gradlew bootRun
```
##### Сервис будет доступен по адресу: *http://localhost:8081*

## **API :**

### **document-generator :**

#### Сгенерировать документы :

**POST** *http://localhost:8081/api/generate*

Тело запроса :
 - **count** - количество документов для генерации
 - **authorPrefix** - префикс автора при генерации *опционально*
 - **namePrefix** - префикс названия документа *опционально*

### **demo-task :**

#### Создать один документ :

**POST** *http://localhost:8080/api/documents/create*

Тело запроса :
 - **author** - автор создавший документ
 - **name** - название документа

#### Получить один документ вместе с историей изменения по ID :

**GET** *http://localhost:8080/api/documents/*[ЗДЕСЬ НУЖНО ВВЕСТИ ID]**

#### Получить несколько документов с пагинацией :

**GET** *http://localhost:8080/api/documents*

**Параметр :** listId - перечень ID которые необходимо получить *опционально*, без указания в ответе будет 10 последних созданных документов

#### Подтвердить несколько документов :

**PATCH** *http://localhost:8080/api/documents/submit*

**Параметр :** listId - перечень ID которые необходимо подтвердить

Тело запроса :
 - **author** - автор подтверждения документа

#### Одобрить несколько документов :

**PATCH** *http://localhost:8080/api/documents/approve*

**Параметр :** listId - перечень ID которые необходимо одобрить

Тело запроса :
 - **author** - автор одобрения документа

#### Поиск по документам :

**GET** *http://localhost:8080/api/documents/search*

**Параметры :**
 - status - поиск по статусу, *опционально*
 - author - поиск по автору документа, *опционально*
 - dateFrom - вывести докиместы созданные позже указанной даты, *опционально*
 - dateTo - вывести документы созданные раньше указанной даты, *опционально*

#### Провести многопоточное тестирование :

**POST** *http://localhost:8080/api/test/concurrent/approve*

## **Логирование**

### **document-generator**

 - Количество документов для генерации
 - Прогресс генерации *(0/10)*
 - Количество сгенерированных документов и время затраченное на генерацию

### **demo-task**

 - При создании документа его ID, UUID и время затраченное на создание документа
 - Поиск документа по ID
 - При поиске нескольких документов, количество документов
 - При подтверждении документов, количество документов и время за которое они были подтверждены
 - При одобрении документов, количество документов и время за которое они были одобрены
### **Workers**

#### *Каждый воркер делает одинаковое логирование*

 - Начало работы воркера
 - Не найдено документов
 - Если найдено, количество документов, сколько отправится в обработку
 - Количество обработанных задач, количество успешно обработанных задач, количество конфликтно обработанных задач, количество не найденныых документов, количество ошибок, сколько осталось доступных для обработки документов

## Оптимизации :

### Для обработки 5000+ ID
 - Разбиение на батчи
 - Применение CompletableFuture для асинхронной отправки каждого батча
 - Использование каждой транзакции отдельно для каждого батча
### Выделение реестра утверждений
#### Я бы выделил под это отдельный HTTP сервис
 - данные в нём могут быть переиспользованы
 - это упрощает масштабируемость 
